<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bonobo Git Server - Install - Federation Authentication</title>
        <meta name="author" content="Jakub Chodounsky">
        <meta name="robots" content="all, follow">
        <meta name="description" content="Setup ADFS authentication with Bonobo Git Server">
        <meta name="keywords" content="Bonobo Git Server, Git Server for Windows, Open Source Git Server, Git, IIS Git, ASP .NET MVC, Install, Installation Guide, Quickstart, Federation Authentication, ADFS">
        <link rel="stylesheet" type="text/css"  href="/resources/css/bootstrap.css">
        <link rel="stylesheet" type="text/css"  href="/resources/css/default.css?v1.2">
        <link rel="stylesheet" type="text/css"  href="/resources/css/prettify.css">
    </head>
    <body>
      <div class="newsletter-signup">
        <form action="//csharpdigest.us13.list-manage.com/subscribe/post?u=f3468acd0f9b5b95b5bed3a20&amp;id=e30bb8a832" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" target="_blank" novalidate>
          <label for="mce-EMAIL2">Do you want to become a <a href="https://csharpdigest.net?utm_source=bonobo&utm_medium=web&utm_campaign=banner">better C# developer</a>?</label>
          <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL2" placeholder="Email address" />
          <input type="submit" value="Subscribe" class="btn btn-danger" name="subscribe" id="mc-embedded-subscribe">
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f3468acd0f9b5b95b5bed3a20_e30bb8a832" tabindex="-1" value=""></div>
        </form>
      </div>
        <div class="container-narrow">
            <div class="clearfix">
                <h3><a class="brand muted" href="/">Bonobo Git Server</a></h3>
                <ul class="nav nav-pills pull-right">
                    <li><a href="/install/">Install</a></li>
                    <li><a href="/screenshots/">Screenshots</a></li>
                    <li><a href="/features/">Features</a></li>
                    <li><a href="/documentation/">Documentation</a></li>
                    <li><a href="/frequently-asked-questions/">Questions</a></li>
                </ul>
            </div>
            <hr />

            <h1 id="federation-authentication">Federation Authentication</h1>

<p>This authentication method uses an ADFS server to authenticate access to Bonobo Git.  The main benefit of using this method is that it is providing single-sign-on capabilities across all of your web sites, if the other sites support federation authentication as well.  </p>

<h2 id="how-to-configure-bonobo-git-server">How to configure Bonobo Git Server?</h2>

<p>Set up the <a href="/ad-membership/">Active Directory Membership Service</a>.</p>

<p>Set the AuthenticationProvider in the application <strong>web.config</strong> according to the following lines.</p>

<pre class="prettyprint"><code>&lt;appSettings&gt;
    ...
    &lt;add key="AuthenticationProvider" value="Federation" /&gt;
    &lt;add key="MembershipService" value="ActiveDirectory" /&gt;
    &lt;add key="FederationMetadataAddress" value="https://sts.domain.local/federationmetadata/2007-06/federationmetadata.xml" /&gt;
    &lt;add key="FederationRealm" value="https://git.domain.local" /&gt;
    ...
&lt;/appSettings&gt;
</code></pre>

<p>Replace the <em>FederationMetadataAddress</em> and <em>FederationRealm</em> values with the ones you configured using the ADFS configuration tool.</p>

<h2 id="how-to-configure-adfs">How to configure ADFS?</h2>

<p>Weâ€™ll give you a recipe here, but if you need more information there is lots on <a href="https://technet.microsoft.com/en-us/library/cc772128%28v=ws.10%29.aspx">TechNet</a>.</p>

<p>You will need to get the <em>metadata address</em> and <em>realm</em> for the trust you created in the ADFS configuration tool in order to configure Bonobo Git.</p>

<ol>
  <li>Open AD FS Management</li>
  <li>Click <code>Add Relying Party Trust</code></li>
  <li>Choose <code>Claims aware</code> and click <code>Start</code></li>
  <li>Choose <code>Enter data about the relaying party manually</code> and click <code>Next</code></li>
  <li>Enter a display name and a description if you want to and click <code>Next</code></li>
  <li>We can skip this page so just click <code>Next</code></li>
  <li>Choose <code>Enable support for the WS-Federation Passive protocol</code> and enter the URL to your git server (must be https)</li>
  <li>Add the contents of your web.config <code>FederationRealm</code> to <code>Relying party trust identifier</code> if it differs from your url and click <code>Next</code></li>
  <li>Now just click <code>Next</code> and <code>Next</code>, leave <code>Configure claims issuance policy for this application</code> checked and then <code>Close</code></li>
</ol>

<p>Now we are at the <code>Edit Claims Issuance Policy for **your name**</code>, we have to add four rules here.
1. Click <code>Add Rule</code>
2. Choose <code>Send Claims Using a Custom Rule</code> and click <code>Next</code>
3. Enter a <code>Claim rule name</code>, use <code>Active Directory</code> for example
4. Paste the following in <code>Custom rule</code>: 
<code>c:[Type == "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname", Issuer == "AD AUTHORITY"]
 =&gt; issue(store = "Active Directory", types = ("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn", "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname", "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname", "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", "http://schemas.microsoft.com/ws/2008/06/identity/claims/role",
"http://temp.org/identity/claims/adObjectGuidBase64org"), query = ";sAMAccountName,givenName,sn,mail,tokenGroups,ObjectGuid;{0}", param = c.Value);</code>
5. Click <code>Finish</code></p>

<p>And the second rule:
1. Click <code>Add Rule</code>
2. Choose <code>Send Claims Using a Custom Rule</code> and click <code>Next</code>
3. Enter a <code>Claim rule name</code>, use <code>Name ID</code> for example
4. Paste the following in <code>Custom rule</code>: 
<code>c:[Type == "http://temp.org/identity/claims/adObjectGuidBase64org"]
 =&gt; issue(Type = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier", Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType, Properties["http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format"] = "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified");</code>
5. Click <code>Finish</code></p>

<p>The third rule:
1. Click <code>Add Rule</code>
2. Choose <code>Send Group Membership as a Claim</code> and click <code>Next</code>
3. Enter <code>Administrator</code> at <code>Claim rule name</code>
4. Select your administrators group as defined in web.config for <code>ActiveDirectoryRoleMapping</code>
5. At <code>Outgoing claim type</code> select <code>Role</code>
6. Enter <code>Administrator</code> at <code>Outgoing claim value</code>
7. Click <code>Finish</code></p>

<p>The fourth rule:
1. Click <code>Add Rule</code>
2. Choose <code>Send Group Membership as a Claim</code> and click <code>Next</code>
3. Enter <code>Member</code> at <code>Claim rule name</code>
4. Select your administrators group as defined in web.config for <code>ActiveDirectoryMemberGroupName</code>
5. At <code>Outgoing claim type</code> select <code>Role</code>
6. Enter <code>Member</code> at <code>Outgoing claim value</code>
7. Click <code>Finish</code></p>

<p>All we have to do now is click <code>Close</code> and AD FS has been setup correctly. Now configure Bonobo Git Server for ADFS</p>

<h2 id="keep-in-mind">Keep in mind</h2>

<p>Git is authenticating to the server via Basic Authentication protocol and sends the password as a part of the request. If you want the communication to be safe you have to introduce SSL in your IIS. With the certificate your application will communicate over HTTPS and it will be encrypted.</p>

<h2 id="links">Links</h2>

<ul>
  <li><a href="/install/">Installation</a></li>
  <li><a href="/web-config/">Web Configuration Documentation</a></li>
</ul>


            <hr />
            <div class="footer">
              <p class="text-center">&copy; <a href="https://chodounsky.com">Jakub Chodounsky</a> 2020  &middot; <a href="/privacy-policy/">Privacy Policy</a></p>
              <p class="text-center">
              Check out our weekly programming newsletters<br>
              <a href="https://csharpdigest.net/?utm_source=bonobo&utm_medium=web&utm_campaign=footer">C# Digest</a> &middot; <a href="https://programmingdigest.net/?utm_source=bonobo&utm_medium=web&utm_campaign=footer">Programming Digest</a> &middot; <a href="https://reactdigest.net/?utm_source=bonobo&utm_medium=web&utm_campaign=footer">React Digest</a> &middot; <a href="https://aidigest.net/?utm_source=bonobo&utm_medium=web&utm_campaign=footer">AI Digest</a> &middot; <a href="https://elixirdigest.net/?utm_source=bonobo&utm_medium=web&utm_campaign=footer">Elixir Digest</a>
              </p>
            </div>

        </div>

        <script src="/resources/js/jquery-1.9.1.min.js"></script>
        <script src="/resources/js/bootstrap.min.js"></script>
        <script src="/resources/js/prettify.js"></script>
        <script src="/resources/js/lang-css.js"></script>
        <script src="/resources/js/lang-lisp.js"></script>
        <script src="/resources/js/lang-scala.js"></script>
        <script src="/resources/js/lang-sql.js"></script>
        <script src="/resources/js/lang-yaml.js"></script>
        <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us13.list-manage.com","uuid":"f3468acd0f9b5b95b5bed3a20","lid":"e30bb8a832"}) })</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-40669399-1', 'bonobogitserver.com');
            ga('send', 'pageview');

            document.addEventListener('DOMContentLoaded',function() { prettyPrint(); });
        </script>
    </body>
</html>
